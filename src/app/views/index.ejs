<!DOCTYPE html>
<html>

<head>
    <%-include includes/head_tags.ejs-%>

    <%-include includes/include_css.ejs-%>

    <!--CSS especificos desta página-->
    <link href="libs/chartist/dist/chartist.min.css" rel="stylesheet">
</head>

<body>
    <div class="preloader">
        <div class="lds-ripple">
            <div class="lds-pos"></div>
            <div class="lds-pos"></div>
        </div>
    </div>
    <div id="main-wrapper" data-navbarbg="skin6" data-theme="light" data-layout="vertical" data-sidebartype="full"
        data-boxed-layout="full">
        <header class="topbar" data-navbarbg="skin6">
            <%-include includes/navbar.ejs-%>
        </header>

        <aside class="left-sidebar" data-sidebarbg="skin5">
            <%-include includes/sidebar_left.ejs-%>
        </aside>

        <div class="page-wrapper">
            <!-- Bread crumb -->
            <div class="page-breadcrumb">
                <div class="row">
                    <div class="col-5 align-self-center">
                        <h4 class="page-title">Dashboard</h4>
                    </div>
                    <div class="col-7 align-self-center">
                        <div class="d-flex align-items-center justify-content-end">
                            <nav aria-label="breadcrumb">
                                <ol class="breadcrumb">
                                    <li class="breadcrumb-item">
                                        <a href="#">Home</a>
                                    </li>
                                    <li class="breadcrumb-item active" aria-current="page">Dashboard</li>
                                </ol>
                            </nav>
                        </div>
                    </div>
                </div>
            </div><!-- End Bread crumb -->

            <!-- Container fluid  -->
            <div class="container-fluid">
                <div class="row">
                    <div class="col-12">
                        <div class="card">
                            <div class="card-body">
                                <h4 class="card-title">Ultimas transações</h4>
                                <hr>
                                <div class="row">
                                    <div class="col-12">
                                        <div class="table-responsive">
                                            <table class="table table-sm table-striped table-borderless" id="bucket">
                                                <tr></tr>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!--End card-->
                    </div>
                    <!--End col-12 -->
                </div>
                <!--End Row -->

                <div class="row">
                    <div class="col-md-8">
                        <div class="card">
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="card">
                                            <div class="card-body">
                                                <h5 class="card-titile m-b-5">
                                                    Block.IO
                                                    <% if(balance){%>
                                                    <span class="text-muted"
                                                        style="margin-left: 8rem;"><%=balance.network%></span>
                                                    <%}%>
                                            </h5>
                                            <hr>
                                            <h5>Saldo disponível:</h5>
                                            <% if(balance){ %>
                                                    <span class="h3 font-light">
                                                        &#3647;
                                                        <span
                                                            id="balance"><%= parseFloat(balance.available_balance)%></span>
                                                    </span>
                                                    <span class="h4 font-light ml-4" id="balance2brl"></span>
                                                    <% } %>
                                                    <h5 class="mt-2">Saldo pendente:</h5>
                                                    <% if(balance){ %>
                                                    <span class="h3 font-light">
                                                        &#3647;
                                                        <span
                                                            id="pendent"><%= parseFloat(balance.pending_received_balance)%></span>
                                                    </span>
                                                    <span class="h4 font-light ml-4" id="pendent2brl"></span>
                                                    <% } %>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="card">
                                            <div class="card-body">
                                                <h5 class="card-title m-b-5">Total de Ganhos <span
                                                        class="font-14 text-muted ml-5" id="data"></span></h5>
                                                <h3 class="font-light">$</h3>
                                                <div class="m-t-20 text-center">
                                                    <div id="earnings"></div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div><!-- End Row -->
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="card">
                            <div class="card-body">
                                <h4 class="card-title m-b-0">Cotação</h4>
                                <h2 class="font-light">
                                    <span id="lastPrice"></span>
                                    <span id="percent" class="font-16 font-medium"></span>
                                </h2>
                                <div class="m-t-30">
                                    <div class="row text-center">
                                        <div class="col-6 border-right">
                                            <h4 class="m-b-0"></h4>
                                            <span class="font-14 text-muted"></span>
                                        </div>
                                        <div class="col-6">
                                            <h4 class="m-b-0"></h4>
                                            <span class="font-14 text-muted"></span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- End container-fluid  -->
        </div>
        <!-- End Page wrapper  -->
    </div>
    <!-- End Main-Wrapper -->

    <%-include includes/include_js.ejs-%>

    <!--JavaScript especificos desta página-->
    <!--chartis chart-->
    <script src="libs/chartist/dist/chartist.min.js"></script>
    <script src="libs/chartist-plugin-tooltips/dist/chartist-plugin-tooltip.min.js"></script>
    <script src="js/pages/dashboards/dashboard1.js"></script>

    <!--WebSocket-->
    <script src="js/websocket.js"></script>

    <script>
        var settings2 = {
            "url": "https://www.mercadobitcoin.net/api/BTC/ticker/",
            "method": "GET",
            "timeout": 0,
            "headers": {
                "Content-Type": "application/json"
            },
        };

        var settings3 = {
            "url": "https://www.mercadobitcoin.net/api/BTC/day-summary/2019/11/12/",
            "method": "GET",
            "timeout": 0,
            "headers": {
                "Content-Type": "application/json"
            },
        };

        var lastPrice;

        $.ajax(settings2).done(function (res){
            lastPrice = res.ticker.last;

            var balance = $('#balance').html();
            $('#balance2brl').html('R$ ' + (balance * lastPrice).toFixed(2));

            var pendent = $('#pendent').html();
            $('#pendent2brl').html('R$ ' + (pendent * lastPrice).toFixed(2));

            $('#lastPrice').html('R$ '+ parseFloat(lastPrice).toFixed(2));
        });

        $.ajax(settings3).done(function (res){
            var open = res.opening;

            if(open < lastPrice){
                var indicador = "+";
                var change = lastPrice - open;
                var percent = change / open;
                percent = percent * 100;
                var color = "green"
            }
            else{
                var indicador = "-";
                var change = lastPrice - open;
                var percent = change / open;
                percent = percent * 100;
                var color = "red"
            }

            $('#percent').html(indicador + percent +' %');
            $('#percent').css('color',color);
        });

       

        

        function dataAtualFormatada(){
            var data = new Date(),
                dia = data.getDate().toString().padStart(2, '0'),
                mes = (data.getMonth() + 1).toString().padStart(2, '0'), //+1 pois no getMonth Janeiro começa com zero.
                ano = data.getFullYear();
            return dia + "/" + mes + "/" + ano;
        }

        $('#data').html(dataAtualFormatada())
    </script>
</body>

</html>